\ProvidesPackage{beamerthemeKTH}[2016/06/21]
\mode<presentation>
\RequirePackage{tikz}
\RequirePackage{amssymb}
% nice symbols
\RequirePackage{fontawesome}
\RequirePackage{manfnt}

\RequirePackage{graphicx}
\RequirePackage{soul}
\RequirePackage{listings}
\RequirePackage{xcolor}
\RequirePackage[percent]{overpic}

% to create plots
\usepackage{pgfplots}

\input{colors.tex}

%%%%% Choose text colors for both themes
%% dark theme
\colorlet{darkBG}{black}  %% NordDarkBlack looks nice too
\colorlet{darknormaltext}{NordWhite}
\colorlet{darkframetitle}{kthcolor}
%\colorlet{darkframesubtitle}{kthcolor_light}
\colorlet{darkbottomtext}{kthcolor}
\colorlet{darktitle}{LightGray}
\colorlet{darkenvironment}{kthcolor}

% light theme (white bg)
\colorlet{lightnormaltext}{DarkGray}
\colorlet{lightframetitle}{kthcolor}
%\colorlet{lightframesubtitle}{kth_green}
\colorlet{lightbottomtext}{kthcolor}
\colorlet{lighttitle}{tab_gray}
\colorlet{lightenvironment}{kthcolor}

% light theme navy (white bg)
\colorlet{navynormaltext}{DarkGray}
\colorlet{navyframetitle}{kthcolor_navy}
%\colorlet{lightframesubtitle}{kth_green}
\colorlet{navybottomtext}{kthcolor_navy}
\colorlet{navytitle}{tab_gray}
\colorlet{navyenvironment}{kthcolor_navy}

\setbeamertemplate{navigation symbols}{}
\setbeamersize{text margin left=10mm,text margin right=10mm}

\pgfdeclareimage[height=20mm]{kthlogo}{kthgraphics/KTH_logo_RGB_bla}
\pgfdeclareimage[height=20mm]{kthlogobg}{kthgraphics/KTH-logo_bla}
\pgfdeclareimage[height=20mm]{kthlogo_white}{kthgraphics/KTH_logo_RGB_vit}
\pgfdeclareimage[height=13mm]{kthlogo_small}{kthgraphics/KTH_logo_RGB_bla}
\pgfdeclareimage[height=13mm]{kthlogo_small_white}{kthgraphics/KTH_logo_RGB_vit}
\pgfdeclareimage[height=13mm]{kthlogobg_small}{kthgraphics/KTH-logo_bla}
%\pgfdeclareimage[height=20mm]{saablogo}{kthgraphics/saab_1.png}
%\pgfdeclareimage[height=13mm]{saablogo_small}{kthgraphics/saab_1.png}
%\pgfdeclareimage[width=\paperwidth, angle=90]{flow_bottom_title}{kthgraphics/bottom_title.pdf}

\newcommand{\kthlines}{%
\begin{tikzpicture}[line width=0.5pt,rounded corners=2pt,color=kthcolor_navy,x=2mm,y=2mm]
  \clip (4,-1) rectangle (81, 12);
  \draw (0,9.5) -- (15,9.5) -- (15,1.7) -- (30,1.7) -- (30,8) -- (44.5,8) -- (44.5,0) -- (55,0) -- (55,9.5)
  -- (63,9.5) -- (63,1) -- (77,1) -- (77,8) -- (82,8) -- (82,6) -- (95,6);
  \draw (0,8) -- (5,8) -- (5,4) -- (20,4) -- (20,9.5) -- (30.5,9.5) -- (30.5,4) -- (48,4) -- (48,7) -- (66,7)
  -- (66,5) -- (73,5) -- (73,10) -- (84.5,10) -- (84.5,3) -- (95,3);
  \draw (0,7) -- (7,7) -- (7,11.5) -- (11,11.5) -- (11,5) -- (18,5) -- (18,8) -- (28.5,8) -- (28.5,5)
  -- (32,5) -- (32,7) -- (36,7) -- (36,5.5) -- (60,5.5) -- (60,11.5) -- (68,11.5) -- (68,7) -- (80,7) -- (80,11) -- (95,11);
  \draw (0,1.7) -- (9,1.7) -- (9,0) -- (33,0) -- (33,1.7) -- (76,1.7) -- (76,0) -- (95,0);
  \draw (0,1) -- (13,1) -- (13,7) -- (25,7) -- (25,1) -- (42,1) -- (42,10) -- (57,10) -- (57,4) -- (61.7,4)
  -- (61.7,8) -- (71,8) -- (71,-0.5) -- (82,-0.5) -- (82,4) -- (95,4);
\end{tikzpicture}}

\newcommand{\kthlinesmulti}{%
\begin{tikzpicture}[line width=0.5pt,rounded corners=2pt,color=kthcolor_navy,x=2mm,y=2mm]
  \clip (4,-1) rectangle (81, 12);
  \draw[kth_green] (0,9.5) -- (15,9.5) -- (15,1.7) -- (30,1.7) -- (30,8) -- (44.5,8) -- (44.5,0) -- (55,0) -- (55,9.5)
  -- (63,9.5) -- (63,1) -- (77,1) -- (77,8) -- (82,8) -- (82,6) -- (95,6);
  \draw[kthcolor_pink] (0,8) -- (5,8) -- (5,4) -- (20,4) -- (20,9.5) -- (30.5,9.5) -- (30.5,4) -- (48,4) -- (48,7) -- (66,7)
  -- (66,5) -- (73,5) -- (73,10) -- (84.5,10) -- (84.5,3) -- (95,3);
  \draw[kthcolor] (0,7) -- (7,7) -- (7,11.5) -- (11,11.5) -- (11,5) -- (18,5) -- (18,8) -- (28.5,8) -- (28.5,5)
  -- (32,5) -- (32,7) -- (36,7) -- (36,5.5) -- (60,5.5) -- (60,11.5) -- (68,11.5) -- (68,7) -- (80,7) -- (80,11) -- (95,11);
  \draw[kthcolor_gray] (0,1.7) -- (9,1.7) -- (9,0) -- (33,0) -- (33,1.7) -- (76,1.7) -- (76,0) -- (95,0);
  \draw[kthcolor_light] (0,1) -- (13,1) -- (13,7) -- (25,7) -- (25,1) -- (42,1) -- (42,10) -- (57,10) -- (57,4) -- (61.7,4)
  -- (61.7,8) -- (71,8) -- (71,-0.5) -- (82,-0.5) -- (82,4) -- (95,4);
\end{tikzpicture}}

\newcommand{\kthsingleline}{%
\begin{tikzpicture}[line width=0.5pt,color=kthcolor,x=2mm,y=2mm]
  \draw (0,0) -- (77,0);
\end{tikzpicture}}

\newcommand{\kthsinglelinenavy}{%
\begin{tikzpicture}[line width=0.5pt,color=kthcolor_navy,x=2mm,y=2mm]
  \draw (0,0) -- (77,0);
\end{tikzpicture}}

%------------------------------------------------------------------------------
% Coordinate system for the page:
%
% -------------------------
% |(0,1)             (1,1)|
% |                       |
% |       (0.5,0.5)       |
% |                       |
% |(0,0)             (1,0)|
% -------------------------
%
% invoke by:
% \node[nodeOptions] (nodeName) at (page cs:xNode,yNode) {nodeContents};
%
\makeatletter
\def\parsecomma#1,#2\endparsecomma{\def\page@x{#1}\def\page@y{#2}}
\tikzdeclarecoordinatesystem{page}{
    \parsecomma#1\endparsecomma
    % Save the lower left corner
    \pgfpointanchor{current page}{south west}
    \pgf@xa=\pgf@x%
    \pgf@ya=\pgf@y%
    % Save the upper right corner
    \pgfpointanchor{current page}{north east}
    \pgf@xb=\pgf@x%
    \pgf@yb=\pgf@y%
    % Transform to the correct placement
    \pgfmathparse{(\pgf@xb-\pgf@xa)*\page@x+\pgf@xa}
    \expandafter\pgf@x\expandafter=\pgfmathresult pt
    \pgfmathparse{(\pgf@yb-\pgf@ya)*\page@y+\pgf@ya}
    \expandafter\pgf@y\expandafter=\pgfmathresult pt
}
\makeatother

%%%% Highlight
\makeatletter
\let\HL\hl
\renewcommand\hl{%
  \let\set@color\beamerorig@set@color
  \let\reset@color\beamerorig@reset@color
  \HL}
\makeatother

%%%% TITLE PAGE BACKGROUND
\newcommand{\startpage}{%
\usebackgroundtemplate{

\begin{tikzpicture}[remember picture,overlay]
  \node[] at  ([shift={(15mm,-15mm)},anchor=north west]current page.north west) {\pgfuseimage{kthlogobg}};
  \node[] at  ([shift={(0.5\paperwidth,-0mm)}]current page.west) {\includegraphics[width=\paperwidth,angle=0]{kthgraphics/Linjemonster_KTH-bla_RGB_16x9_BR.png}};
  \node[] at  ([shift={(0.5\paperwidth,-0mm)}]current page.west) {\scalebox{1}[-1]{\includegraphics[width=\paperwidth,angle=0]{kthgraphics/Linjemonster_KTH-bla_RGB_16x9_TL.png}}};
  \node[] at  ([shift={(0.5\paperwidth,-0mm)}]current page.west) {\scalebox{-1}[-1]{\includegraphics[width=\paperwidth,angle=0]{kthgraphics/Linjemonster_KTH-bla_RGB_16x9_BL.png}}};
  \node[] at  ([shift={(0.5\paperwidth,22mm)}]current page.west) {\includegraphics[width=0.35\paperwidth,angle=0]{kthgraphics/flow_name_transparent_KTHbla.png}};
  %\node[] at  ([shift={(0mm,7mm)}]current page.south) {\kthsingleline};
  %\node[] at  ([shift={(0mm,3.0mm)}]current page.south) {\includegraphics[width=\paperwidth,angle=180]{kthgraphics/bottom_title_transparent.png}};
  %\node[] at  ([shift={(8mm,6.0mm)}]current page.south west) {\includegraphics[width=0.08\textwidth]{kthgraphics/flow_name_transparent.png}};
\end{tikzpicture}

    }
  \setbeamercolor{title}{fg=lighttitle}
}

%%%% TITLE PAGE BACKGROUND navy
\newcommand{\startpagenavy}{%
\usebackgroundtemplate{

\begin{tikzpicture}[remember picture,overlay]
  \node[] at  ([shift={(15mm,-15mm)}]current page.north west) {\pgfuseimage{kthlogo}};
  \node[] at  ([shift={(0.5\paperwidth,-0mm)}]current page.west) {\includegraphics[width=\paperwidth,angle=0]{kthgraphics/Linjemonster_marinbla_RGB_16x9_BR.png}};
  \node[] at  ([shift={(0.5\paperwidth,-0mm)}]current page.west) {\scalebox{1}[-1]{\includegraphics[width=\paperwidth,angle=0]{kthgraphics/Linjemonster_marinbla_RGB_16x9_TL.png}}};
  \node[] at  ([shift={(0.5\paperwidth,-0mm)}]current page.west) {\scalebox{-1}[-1]{\includegraphics[width=\paperwidth,angle=0]{kthgraphics/Linjemonster_marinbla_RGB_16x9_BL.png}}};
  \node[] at  ([shift={(0.5\paperwidth,22mm)}]current page.west) {\includegraphics[width=0.35\paperwidth,angle=0]{kthgraphics/flow_name_transparent_marinbla.png}};
  %\node[] at  ([shift={(0mm,7mm)}]current page.south) {\kthsingleline};
  %\node[] at  ([shift={(0mm,3.0mm)}]current page.south) {\includegraphics[width=\paperwidth,angle=180]{kthgraphics/bottom_title_transparent.png}};
  %\node[] at  ([shift={(8mm,6.0mm)}]current page.south west) {\includegraphics[width=0.08\textwidth]{kthgraphics/flow_name_transparent.png}};
\end{tikzpicture}

    }
  \setbeamercolor{title}{fg=navytitle}
}

%%%% TITLE PAGE BACKGROUND Old
\newcommand{\startpageold}{%
\usebackgroundtemplate{\vbox{\null
    \vspace{5mm}\hspace{5mm}\pgfuseimage{kthlogo}\par
\vspace{-12mm}
  \parbox[c]{\paperwidth}{\centering\includegraphics[width=0.4\textwidth]{kthgraphics/flow_name.png}}\par
  %\vspace{38mm}\hbox{\hspace{3mm}\kthlinesmulti}%
  \vspace{38mm}\hbox{\hspace{3mm}\kthlines}%
  \vspace{5mm}\hbox{\hspace{3mm}\kthsingleline}
  %\vspace{46.5mm}\parbox[c]{\paperwidth}{\centering\pgfuseimage{kthlogo}}
  %\vspace{0mm}
  %\includegraphics[width=\paperwidth,angle=180]{kthgraphics/bottom_title.pdf}
}
    }
}

%%%% TITLE PAGE BACKGROUND BLACK
\newcommand{\startpagedark}{%
\usebackgroundtemplate{
\begin{tikzpicture}[remember picture,overlay]
\shade[top color=darkBG,bottom color=darkBG]
  ([shift={(0.0cm,0.0cm)}]current page.north west)
     rectangle
  ([shift={(0.0cm,0.0cm)}]current page.south east);
  \node[] at  ([shift={(15mm,-15mm)}]current page.north west) {\pgfuseimage{kthlogo_white}};
  \node[] at  ([shift={(0.5\paperwidth,-0mm)}]current page.west) {\includegraphics[width=\paperwidth,angle=0]{kthgraphics/Linjemonster_vit_RGB_16x9_BR.png}};
  \node[] at  ([shift={(0.5\paperwidth,-0mm)}]current page.west) {\scalebox{1}[-1]{\includegraphics[width=\paperwidth,angle=0]{kthgraphics/Linjemonster_vit_RGB_16x9_TL.png}}};
  \node[] at  ([shift={(0.5\paperwidth,-0mm)}]current page.west) {\scalebox{-1}[-1]{\includegraphics[width=\paperwidth,angle=0]{kthgraphics/Linjemonster_vit_RGB_16x9_BL.png}}};
  \node[] at  ([shift={(0.5\paperwidth,22mm)}]current page.west) {\includegraphics[width=0.35\paperwidth,angle=0]{kthgraphics/flow_name_transparent_KTHbla.png}};
\end{tikzpicture}

    }
    \setbeamercolor{title}{fg=darktitle}
}

%%%% TITLE PAGE BACKGROUND BLACK Old
\newcommand{\startpagedarkold}{%
\usebackgroundtemplate{
\begin{tikzpicture}[remember picture,overlay]
\shade[top color=darkBG,bottom color=darkBG]
  ([shift={(0.0cm,0.0cm)}]current page.north west)
     rectangle
  ([shift={(0.0cm,0.0cm)}]current page.south east);
\end{tikzpicture}

\vbox{\null
    \vspace{3mm}\hspace{3mm}\pgfuseimage{kthlogo_white}\par
\vspace{-12mm}
  \parbox[c]{\paperwidth}{\centering\includegraphics[width=0.4\textwidth]{kthgraphics/flow_name_transparent2.png}}\par
  \vspace{38mm}\hbox{\hspace{3mm}\kthlinesmulti}%
  %\vspace{38mm}\hbox{\hspace{3mm}\kthlines}%
  \vspace{5mm}\hbox{\hspace{3mm}\kthsingleline}
  %\vspace{46.5mm}\parbox[c]{\paperwidth}{\centering\pgfuseimage{kthlogo}}
  %\vspace{0mm}
  %\includegraphics[width=\paperwidth,angle=180]{kthgraphics/bottom_title.pdf}
}
    }
    \setbeamercolor{title}{fg=darktitle}
}
%%%% TITLE PAGE BACKGROUND SAAB
%\newcommand{\startpagesaab}{%
%\usebackgroundtemplate{\vbox{\null
%    \vspace{3mm}\hspace{3mm}\pgfuseimage{kthlogo}
%    \hspace*{0.8\textwidth}\pgfuseimage{saablogo}\par
%\vspace{-12mm}
%  \parbox[c]{\paperwidth}{\centering\includegraphics[width=0.4\textwidth]{kthgraphics/flow_name.png}}\par
%  \vspace{38mm}\hbox{\hspace{3mm}\kthlines}%
%  \vspace{5mm}\hbox{\hspace{3mm}\kthsingleline}
%  %\vspace{46.5mm}\parbox[c]{\paperwidth}{\centering\pgfuseimage{kthlogo}}
%  %\vspace{0mm}
%  %\includegraphics[width=\paperwidth,angle=180]{kthgraphics/bottom_title.pdf}
%}
%    }
%}

%%% NORMAL PAGE BACKGROUND LINE
\newcommand{\normalpageline}{%
\usebackgroundtemplate{
\begin{tikzpicture}[remember picture,overlay]
%\shade[top color=white,bottom color=white]
%  ([shift={(0.0cm,0.0cm)}]current page.north west)
%     rectangle
%  ([shift={(0.0cm,0.0cm)}]current page.south east);
  %(0,0) rectangle(\paperwidth,\paperheight);
  \node[] at  ([shift={(10mm,-10mm)}]current page.north west) {\pgfuseimage{kthlogobg_small}};
  \node[] at  ([shift={(0mm,7mm)}]current page.south) {\kthsingleline};
  \node[] at  ([shift={(0mm,3mm)}]current page.south) {
\begin{tabular}{p{0.3\paperwidth}p{0.3\paperwidth} p{0.3\paperwidth}}
 \includegraphics[width=0.1\textwidth]{kthgraphics/flow_name_transparent_KTHbla.png}  &
 \centering\small{\textcolor{lightbottomtext}{\insertshorttitle }} &  
 %\centering{\small{\textcolor{black}{\insertshortinstitute }}} &
 \hfill\small{\textcolor{lightbottomtext}{\insertframenumber/\insertmainframenumber}} 
 \end{tabular}
  };
\end{tikzpicture}

    }
    \setbeamercolor{frametitle}{fg=lightframetitle}
    \setbeamercolor{framesubtitle}{fg=lightframesubtitle}
    \setbeamercolor{normal text}{fg=lightnormaltext,bg=white}
    \usebeamercolor[fg]{normal text}
    \setbeamercolor{block title}{bg=lightenvironment,fg=white}
    \setbeamercolor{block body}{bg=lightenvironment!20,fg=black}
    \setbeamercolor{section number projected}{bg=lightenvironment,fg=white}
    \setbeamercolor{itemize item}{fg=lightenvironment}
    \lstset{style=mystyle}
}

%%% NORMAL PAGE BACKGROUND LINE NAVY
\newcommand{\normalpagelinenavy}{%
\usebackgroundtemplate{
\begin{tikzpicture}[remember picture,overlay]
%\shade[top color=white,bottom color=white]
%  ([shift={(0.0cm,0.0cm)}]current page.north west)
%     rectangle
%  ([shift={(0.0cm,0.0cm)}]current page.south east);
  %(0,0) rectangle(\paperwidth,\paperheight);
  \node[] at  ([shift={(10mm,-10mm)}]current page.north west) {\pgfuseimage{kthlogo_small}};
  \node[] at  ([shift={(0mm,7mm)}]current page.south) {\kthsinglelinenavy};
  \node[] at  ([shift={(0mm,3mm)}]current page.south) {
\begin{tabular}{p{0.3\paperwidth}p{0.3\paperwidth} p{0.3\paperwidth}}
 \includegraphics[width=0.1\textwidth]{kthgraphics/flow_name_transparent_marinbla.png}  &
 \centering\small{\textcolor{navybottomtext}{\insertshorttitle }} &  
 %\centering{\small{\textcolor{black}{\insertshortinstitute }}} &
 \hfill\small{\textcolor{navybottomtext}{\insertframenumber/\insertmainframenumber}} 
 \end{tabular}
  };
\end{tikzpicture}

    }
    \setbeamercolor{frametitle}{fg=navyframetitle}
    \setbeamercolor{framesubtitle}{fg=navyframesubtitle}
    \setbeamercolor{normal text}{fg=navynormaltext,bg=white}
    \usebeamercolor[fg]{normal text}
    \setbeamercolor{block title}{bg=navyenvironment,fg=white}
    \setbeamercolor{block body}{bg=navyenvironment!20,fg=black}
    \setbeamercolor{section number projected}{bg=navyenvironment,fg=white}
    \setbeamercolor{itemize item}{fg=navyenvironment}
    \lstset{style=mystyle}
}

%%% NORMAL PAGE BACKGROUND WAVES
\newcommand{\normalpagewaves}{%
\usebackgroundtemplate{

\begin{tikzpicture}[remember picture,overlay]
  \node[] at  ([shift={(10mm,-10mm)}]current page.north west) {\pgfuseimage{kthlogobg_small}};
  %\node[] at  ([shift={(0mm,7mm)}]current page.south) {\kthsingleline};
  \node[] at  ([shift={(0mm,3.0mm)}]current page.south) {\includegraphics[width=\paperwidth,angle=180]{kthgraphics/bottom_title_transparent_KTHbla.png}};
  \node[] at  ([shift={(0mm,2mm)}]current page.south) {
   \hbox{
\begin{tabular}{p{0.3\paperwidth}p{0.3\paperwidth} p{0.3\paperwidth}}
 %\includegraphics[width=0.1\textwidth]{kthgraphics/flow_name_transparent2.png}  &
 %\centering\small{\textcolor{kthcolor_gray}{\insertshorttitle }} &  
 \small{\textcolor{white}{\insertshortinstitute }} &
 \centering{ \small{\textcolor{white}{\insertshorttitle }}} & 
 \hfill\small{\textcolor{white}{\insertframenumber/\insertmainframenumber}} 
 \end{tabular}
 }
  };
  \node[] at  ([shift={(8mm,7.0mm)}]current page.south west) {\includegraphics[width=0.08\textwidth]{kthgraphics/flow_name_transparent_kthbla.png}};
\end{tikzpicture}

    }
    \setbeamercolor{frametitle}{fg=lightframetitle}
    \setbeamercolor{framesubtitle}{fg=lightframesubtitle}
    \setbeamercolor{normal text}{fg=lightnormaltext,bg=white}
    \usebeamercolor[fg]{normal text}
    \setbeamercolor{block title}{bg=lightenvironment,fg=white}
    \setbeamercolor{block body}{bg=lightenvironment!20,fg=black}
    \setbeamercolor{section number projected}{bg=lightenvironment,fg=white}
    \setbeamercolor{itemize item}{fg=lightenvironment}
    \lstset{style=mystyle}
}

%%% NORMAL PAGE BACKGROUND WAVES NAVY
\newcommand{\normalpagewavesnavy}{%
\usebackgroundtemplate{

\begin{tikzpicture}[remember picture,overlay]
  \node[] at  ([shift={(10mm,-10mm)}]current page.north west) {\pgfuseimage{kthlogo_small}};
  %\node[] at  ([shift={(0mm,7mm)}]current page.south) {\kthsingleline};
  \node[] at  ([shift={(0mm,3.0mm)}]current page.south) {\includegraphics[width=\paperwidth,angle=180]{kthgraphics/bottom_title_transparent_marinbla.png}};
  \node[] at  ([shift={(0mm,2mm)}]current page.south) {
   \hbox{
\begin{tabular}{p{0.3\paperwidth}p{0.3\paperwidth} p{0.3\paperwidth}}
 %\includegraphics[width=0.1\textwidth]{kthgraphics/flow_name_transparent2.png}  &
 %\centering\small{\textcolor{kthcolor_gray}{\insertshorttitle }} &  
 \small{\textcolor{white}{\insertshortinstitute }} &
 \centering{ \small{\textcolor{white}{\insertshorttitle }}} & 
 \hfill\small{\textcolor{white}{\insertframenumber/\insertmainframenumber}} 
 \end{tabular}
 }
  };
  \node[] at  ([shift={(8mm,7.0mm)}]current page.south west) {\includegraphics[width=0.08\textwidth]{kthgraphics/flow_name_transparent_marinbla.png}};
\end{tikzpicture}

    }
    \setbeamercolor{frametitle}{fg=navyframetitle}
    \setbeamercolor{framesubtitle}{fg=navyframesubtitle}
    \setbeamercolor{normal text}{fg=navynormaltext,bg=white}
    \usebeamercolor[fg]{normal text}
    \setbeamercolor{block title}{bg=navyenvironment,fg=white}
    \setbeamercolor{block body}{bg=navyenvironment!20,fg=black}
    \setbeamercolor{section number projected}{bg=navyenvironment,fg=white}
    \setbeamercolor{itemize item}{fg=navyenvironment}
\lstset{style=mystyle}
}
%%% NORMAL PAGE BACKGROUND SAAB
%\newcommand{\normalpagesaab}{%
%\usebackgroundtemplate{\vbox{\null
%    \vspace{3mm}
%  \hspace{3mm}\pgfuseimage{kthlogo_small}
%  \hspace*{0.9\textwidth}\pgfuseimage{saablogo_small}\par
%  \vspace{\paperheight}\vspace{-28.5mm}
%  \hspace{3mm}\includegraphics[width=0.1\textwidth]{kthgraphics/flow_name.png}\par
%  \vspace{1mm}
%  \begin{overpic}[width=\paperwidth, angle=180]{kthgraphics/bottom_title.pdf}
%  %\vspace{\paperheight}\vspace{-6mm}\hbox{\hspace{3mm}\kthsingleline}
%   \vspace{1mm}
%   \hbox{
%   \begin{tabular}{p{0.3\paperwidth}p{0.3\paperwidth} p{0.3\paperwidth}}
%   \small{\textcolor{white}{\insertshorttitle }} &  
%   \centering{\small{\textcolor{white}{\insertshortinstitute }}} &
%   \hfill\small{\textcolor{white}{\insertframenumber/\insertmainframenumber}}
%  
%   \end{tabular}
%            }
%            \end{overpic}
%        }
%    }
%}


%%% DARK PAGE BACKGROUND WITH LINE
\newcommand{\darkpageline}{%
\usebackgroundtemplate{
\begin{tikzpicture}[remember picture,overlay]
\shade[top color=darkBG,bottom color=darkBG]
  ([shift={(0.0cm,0.0cm)}]current page.north west)
     rectangle
  ([shift={(0.0cm,0.0cm)}]current page.south east);
  %(0,0) rectangle(\paperwidth,\paperheight);
  \node[] at  ([shift={(10mm,-10mm)}]current page.north west) {\pgfuseimage{kthlogo_small_white}};
  \node[] at  ([shift={(0mm,7mm)}]current page.south) {\kthsingleline};
  \node[] at  ([shift={(0mm,3mm)}]current page.south) {
\begin{tabular}{p{0.3\paperwidth}p{0.3\paperwidth} p{0.3\paperwidth}}
 \includegraphics[width=0.1\textwidth]{kthgraphics/flow_name_transparent_KTHbla.png}  &
 \centering\small{\textcolor{darkbottomtext}{\insertshorttitle }} &  
 %\centering{\small{\textcolor{black}{\insertshortinstitute }}} &
 \hfill\small{\textcolor{darkbottomtext}{\insertframenumber/\insertmainframenumber}}
 \end{tabular}
  };
\end{tikzpicture}
}
\setbeamercolor{frametitle}{fg=darkframetitle}
\setbeamercolor{framesubtitle}{fg=darkframesubtitle}
\setbeamercolor{normal text}{fg=darknormaltext}
\usebeamercolor[fg]{normal text}
\setbeamercolor{block title}{bg=darkenvironment,fg=white}
\setbeamercolor{block body}{bg=darkenvironment!20,fg=black}
\setbeamercolor{section number projected}{bg=darkenvironment,fg=white}
\setbeamercolor{itemize item}{fg=darkenvironment}
\lstset{style=mystyleblack}
}

%%% NOTE PAGE BACKGROUND
\setbeamercolor{note page}{bg=yellow!5}
%\setbeamertemplate{note page}{\pagecolor{yellow!5}\insertnote}\usepackage{palatino}


%%% WHITE PAGE BACKGROUND
\newcommand{\whitepage}{%
\usebackgroundtemplate{
}
\setbeamercolor{frametitle}{fg=lightframetitle}
\setbeamercolor{framesubtitle}{fg=lightframesubtitle}
\setbeamercolor{normal text}{fg=lightnormaltext,bg=white}
\usebeamercolor[fg]{normal text}
\setbeamercolor{block title}{bg=lightenvironment,fg=white}
\setbeamercolor{block body}{bg=lightenvironment!20,fg=black}
\setbeamercolor{section number projected}{bg=lightenvironment,fg=white}
\setbeamercolor{itemize item}{fg=lightenvironment}
\lstset{style=mystyle}
}


%%% DARK PAGE BACKGROUND
\newcommand{\darkpage}{%
\usebackgroundtemplate{
\begin{tikzpicture}[remember picture,overlay]
\shade[top color=darkBG,bottom color=darkBG]
  ([shift={(0.0cm,0.0cm)}]current page.north west)
     rectangle
  ([shift={(0.0cm,0.0cm)}]current page.south east);
\end{tikzpicture}
}
\setbeamercolor{frametitle}{fg=darkframetitle}
\setbeamercolor{framesubtitle}{fg=darkframesubtitle}
\setbeamercolor{normal text}{fg=darknormaltext}
\setbeamercolor{block title}{bg=darkenvironment,fg=white}
\setbeamercolor{block body}{bg=darkenvironment!20,fg=black}
\usebeamercolor[fg]{normal text}
\setbeamercolor{section number projected}{bg=darkenvironment,fg=white}
\setbeamercolor{itemize item}{fg=darkenvironment}
\lstset{style=mystyleblack}
}



\newcommand{\transitionpage}[1]{%
\usebackgroundtemplate{
\begin{tikzpicture}[remember picture,overlay]
\shade[top color=kthcolor,bottom color=kthcolor]
  ([shift={(0.0cm,0.0cm)}]current page.north west)
     rectangle
  ([shift={(0.0cm,0.0cm)}]current page.south east);
  \node[] at  ([shift={(0.5\paperwidth,-0mm)}]current page.west) {\includegraphics[width=\paperwidth,angle=0]{kthgraphics/Linjemonster_marinbla_RGB_16x9_BR.png}};
  \node[] at  ([shift={(0.5\paperwidth,-0mm)}]current page.west) {\scalebox{1}[-1]{\includegraphics[width=\paperwidth,angle=0]{kthgraphics/Linjemonster_marinbla_RGB_16x9_TL.png}}};
  \node[] at  ([shift={(0.5\paperwidth,-0mm)}]current page.west) {\scalebox{-1}[-1]{\includegraphics[width=\paperwidth,angle=0]{kthgraphics/Linjemonster_marinbla_RGB_16x9_BL.png}}};
  \node[anchor=center] at (current page.center) {
    \textbf{\Huge{\color{white} #1}}
  };
\end{tikzpicture}
}
\begin{frame}
    %\centering
    %\textbf{\Huge{\color{white} #1}}
\end{frame}
}

%%%%%%%%%%%% SOME FORMAT FOR EVERY SLIDE

%\setbeamercolor{normal}{fg=DarkGray}
%\setbeamercolor{title}{fg=UniBlue}
%\setbeamercolor{structure}{fg=UniBlue}
%\setbeamercolor{normal text}{fg=DarkGray,bg=white}
%\setbeamercolor{section number projected}{bg=UniBlue,fg=white}

\setbeamerfont{title}{series=\bfseries}
\setbeamerfont{framesubtitle}{size=\small}

\setbeamertemplate{frametitle}{\vspace{4mm}\hspace{15mm}\insertframetitle\par
    \hspace{15mm}\usebeamerfont{framesubtitle}\insertframesubtitle
    
}
\setbeamercolor{alerted text}{fg=kth_brick}
\setbeamercolor{structure}{fg=kthcolor}


\setbeamertemplate{blocks}[rounded][shadow=true]

\setbeamerfont{block title}{series=\bfseries}

\setbeamercolor{block title alerted}{bg=kth_darkbrick,fg=white}
\setbeamerfont{block title alerted}{series=\bfseries}
\setbeamercolor{block body alerted}{bg=kth_darkbrick!20,fg=black}
  
\setbeamercolor{block title example}{bg=kthcolor_skyblue,fg=white}
\setbeamerfont{block title example}{series=\bfseries}
\setbeamercolor{block body example}{bg=kthcolor_skyblue!20,fg=black}

%%%%%% ITEM FORMAT
%\setbeamertemplate{itemize item}{\color{kthcolor}$\bullet$}
%\setbeamertemplate{itemize subitem}{\color{kthcolor_light}$\bullet$}
%\setbeamercolor{itemize item}{fg=kthcolor}
\setbeamercolor{itemize subitem}{fg=kthcolor_skyblue}
\setbeamercolor{itemize subbody}{fg=LightGray}

\setbeamertemplate{itemize item}{\scriptsize\raise1.25pt\hbox{\donotcoloroutermaths$\blacktriangleright$}}
\setbeamertemplate{itemize subitem}{\tiny\raise1.5pt\hbox{\donotcoloroutermaths$\bullet$}}
\setbeamertemplate{itemize subsubitem}{\tiny\raise1.5pt\hbox{\donotcoloroutermaths$\blacksqaure$}}

\setbeamertemplate{enumerate item}{\color{kthcolor}\Roman{enumi}}
\setbeamertemplate{enumerate subitem}{\color{kthcolor_skyblue}\roman{enumii}}

%%%%%%% TITLE PAGE  
  \defbeamertemplate*{title page}{customized}[1][]
{\begin{center}
  %\bigskip
  \vspace*{1cm}
  \usebeamerfont{title}\usebeamercolor[fg]{title}\inserttitle\par
  \usebeamerfont{subtitle}\insertsubtitle\par
  \bigskip
  \usebeamerfont{author}\insertauthor\par
  \bigskip
  \usebeamerfont{institute}\insertinstitute\par
  \usebeamerfont{date}\insertdate\par
 \end{center}
}


%%%%%%%%%%%%%%% TABLE OF CONTENTS

\setbeamertemplate{section in toc}[circle]
\setbeamerfont{section number projected}{size=\large}
\setbeamercolor{section in toc}{fg=lightnormaltext}
\setbeamerfont{section in toc}{size=\large}


%%%%%%%%%%%% Setting path to Figures
\graphicspath{{figures/}}


%%%%%%%%%%% FOOTNOTE POSITION
\setbeamercolor{footnote}{fg=kth_gray}
\renewcommand\footnoterule{\rule{\linewidth}{0pt}}
\setbeamertemplate{footnote}{
        \parindent 0em\noindent%
        \raggedleft
        %\raggedright
            \usebeamercolor{footnote}\hbox to 0.8em{\hfil\insertfootnotemark}\insertfootnotetext\par%
        \vspace{0.6cm}
        }


%%%% LISTINGS FORMAT
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{hlcolor},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}

\lstdefinestyle{mystyleblack}{
    backgroundcolor=,   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    %basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}

\lstset{style=mystyle}



%% Reynolds number
\newcommand{\Reyn}{\operatorname{\mathit{Re}}}
\newcommand\Rey{\mbox{\textit{Re}}}

%% Highlighting color
\definecolor{hlcolor}{rgb}{0.95, 0.95, 0.92} 
\sethlcolor{hlcolor}
\let\OldTexttt\texttt
\renewcommand{\texttt}[1]{\OldTexttt{\hl{#1}}}

% move title to center
% \makeatletter
% \setbeamertemplate{frametitle}{
%     \ifbeamercolorempty[bg]{frametitle}{}{\nointerlineskip}%
%     \@tempdima=\textwidth%
%     \advance\@tempdima by\beamer@leftmargin%
%     \advance\@tempdima by\beamer@rightmargin%
%     \advance\@tempdima by -23mm%
%     \vskip -1mm%
%     \begin{beamercolorbox}[sep=0.3cm,left,wd=\the\@tempdima]{frametitle}
%         \usebeamerfont{frametitle}%
%         \vbox{}\vskip+1ex%
%         \if@tempswa\else\csname beamer@ftecenter\endcsname\fi%
%         \strut\insertframetitle\strut\par%
%         {%
%             \ifx\insertframesubtitle\@empty%
%             \else%
%             {\usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}\insertframesubtitle\strut\par}%
%             \fi
%         }%
%         \vskip-1ex%
%         \if@tempswa\else\vskip-.3cm\fi% set inside beamercolorbox... evil here...
%     \end{beamercolorbox}%
% }
% \makeatother
